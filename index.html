<!doctype html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Marxia â€” Orden RÃ¡pida</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --fg:#e8eef6; --card:#161a2b; --line:#2b2f40; --muted:#a9b3c3;
      --op1:#7aa8ff; --op2:#22c3a6; --op3:#ff8ab3; --op4:#c466ff; --ex:#c3b5ff;
      --radius:14px; --gap:1rem; --pad:1rem;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#0e1324,#0b1720,#151a2e);color:var(--fg);min-height:100%}
    body{display:flex;align-items:center;justify-content:center}
    .wrap{width:100%;max-width:1200px;margin:auto;padding:2rem 1rem}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}
    h1{margin:0;font-size:1.8rem}
    .controls{display:flex;gap:.5rem}
    .toggle{padding:.5rem 1rem;border:1px solid var(--line);background:var(--card);color:var(--fg);border-radius:999px;font-weight:700;cursor:pointer}
    .layout{display:grid;grid-template-columns:1fr .8fr;gap:var(--gap)}
    @media (max-width:900px){.layout{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:var(--pad)}
    /* make aside vertically stack so accept can align right */
    aside.card{display:flex;flex-direction:column}
    .title{font-size:1.2rem;font-weight:800;margin:0 0 1rem}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:var(--gap)}
    .opt{background:rgba(255,255,255,.02);border:2px solid var(--line);border-radius:var(--radius);padding:1rem;transition:transform .15s ease,background .15s ease}
    .opt:hover{background:rgba(255,255,255,.05);transform:scale(1.02)}
    .top{display:flex;align-items:center;gap:.8rem;margin-bottom:.5rem}
    .btn50{width:44px;height:35px;border:none;border-radius:8px;font-weight:900;color:#111}
    .op1{background:var(--op1)} .op2{background:var(--op2)} .op3{background:var(--op3)} .op4{background:var(--op4)}
    .desc{color:var(--muted);font-size:.95rem}
    .actions{display:flex;gap:.5rem;margin-top:.6rem}
    .btn{padding:6px 12px;border:1px solid var(--line);background:transparent;color:var(--fg);font-weight:800;border-radius:10px;cursor:pointer;font-size:13px;white-space:nowrap;transition:background .15s ease,color .15s ease,border-color .15s ease}
    /* visual feedback when adding */
    .btn-adding{background:#22c3a6 !important;color:#0b0f18 !important;border-color:#22c3a6 !important}
    .ex-list{display:flex;flex-direction:column;gap:.75rem}
    .ex-row{display:grid;grid-template-columns:1fr auto;align-items:center;background:rgba(255,255,255,.03);border:1px solid var(--line);border-radius:12px;padding:.75rem 1rem}
    .ex-left{display:flex;align-items:center;gap:1rem;font-weight:800}
    .ex-price{font-size:.9rem;padding:.35rem .7rem;border-radius:8px;border:1px dashed var(--line);background:rgba(255,255,255,.05);font-weight:800}
    .cart{border:1px dashed var(--line);border-radius:var(--radius);padding:1rem;max-height:320px;overflow:auto}
    .line{display:grid;grid-template-columns:1fr auto auto;gap:.6rem;align-items:center;padding:.6rem 0;border-bottom:1px dotted rgba(255,255,255,.06)}
    .qtybox{display:flex;align-items:center;gap:.5rem}
    .totals{margin-top:1rem;display:grid;gap:.5rem}
    .totals .row{display:flex;justify-content:space-between}
    .grand{font-size:1.6rem;font-weight:900}
    /* bigger accept button, right aligned */
    .accept-btn{margin-top:1.2rem;padding:1rem 2rem;font-size:1.2rem;background:var(--op2);color:#0b0f18;border:none;border-radius:12px;cursor:pointer;align-self:flex-end;box-shadow:0 6px 18px rgba(0,0,0,.22);transition:transform .06s ease,background .2s ease}
    .accept-btn:active{transform:translateY(1px)}
    .accept-btn:hover{background:#1aa58a}
    /* toast */
    .toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:#22c3a6;color:#0b0f18;padding:.75rem 1.1rem;border-radius:12px;font-weight:900;box-shadow:0 10px 26px rgba(0,0,0,.25);opacity:0;pointer-events:none;transition:opacity .25s ease;z-index:10000}
    .toast.show{opacity:1}
    /* loader overlay */
    .loader-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:9999}
    .loader{width:54px;height:54px;border:6px solid rgba(255,255,255,.25);border-top-color:#22c3a6;border-radius:50%;animation:spin .9s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    /* light theme support */
    [data-theme="light"] body{background:linear-gradient(135deg,#f3fbf7,#eaf2ff,#ffe9ef)}
    [data-theme="light"] .btn-adding{background:#22c3a6 !important;color:#0b0f18 !important}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Orden RÃ¡pida</h1>
      <div class="controls">
        <button id="lang" class="toggle" aria-label="EN/ES">ES</button>
        <button id="theme" class="toggle" aria-label="Light/Dark">ðŸŒ™</button>
      </div>
    </header>

    <div class="layout">
      <!-- LEFT: Opciones + Extras -->
      <section class="card">
        <h2 class="title">Opciones</h2>
        <div id="opts" class="grid"></div>

        <div class="card" style="margin-top:14px">
          <h2 class="title">Extras</h2>
          <div id="extras" class="ex-list"></div>
        </div>
      </section>

      <!-- RIGHT: Resumen -->
      <aside class="card">
        <h2 class="title">Resumen</h2>
        <div id="cart" class="cart" aria-live="polite" aria-atomic="true"></div>

        <div class="totals" aria-live="polite" aria-atomic="true">
          <div class="row"><div>Subtotal</div><div id="subtotal">â€”</div></div>
          <div class="row"><div>IVA (15%)</div><div id="vat">â€”</div></div>
          <div class="row"><div class="grand">TOTAL</div><div id="total" class="grand">â€”</div></div>
        </div>

        <button id="accept" class="accept-btn">Aceptar</button>
      </aside>
    </div>
  </div>

  <!-- Loader + Toast -->
  <div id="loader" class="loader-overlay"><div class="loader"></div></div>
  <div id="toast" class="toast">Â¡Pedido enviado con Ã©xito!</div>

  <script>
    // ===== Config =====
    const IVA_RATE = 0.15;
    const LOCALE = { es: 'es-EC', en: 'en-US' };
    let currentLang = 'es';

    // ===== Data =====
    const OPTIONS = [
      { id:'op1', name:{es:'OpciÃ³n 1',en:'Option 1'}, desc:{es:'Tortilla + Huevos + Chorizo + Bebida', en:'Tortilla + Eggs + Sausage + Drink'}, priceCents:320 },
      { id:'op2', name:{es:'OpciÃ³n 2',en:'Option 2'}, desc:{es:'Tortilla + Chorizo + Bebida', en:'Tortilla + Sausage + Drink'}, priceCents:270 },
      { id:'op3', name:{es:'OpciÃ³n 3',en:'Option 3'}, desc:{es:'Tortilla + Huevos + Bebida', en:'Tortilla + Eggs + Drink'}, priceCents:270 },
      { id:'op4', name:{es:'OpciÃ³n 4',en:'Option 4'}, desc:{es:'2 Tortilla + 2 Huevos + 2 Chorizo + 2 Bebida', en:'2 Tortillas + 2 Eggs + 2 Sausages + 2 Drinks'}, priceCents:640 }
    ];
    const EXTRAS = [
      { id:'ex_cafe', name:{es:'CafÃ©',en:'Coffee'}, priceCents:70 },
      { id:'ex_cola', name:{es:'Cola',en:'Cola'}, priceCents:70 },
      { id:'ex_chorizo', name:{es:'Chorizo',en:'Sausage'}, priceCents:70 },
      { id:'ex_huevo', name:{es:'Huevo',en:'Egg'}, priceCents:70 },
      { id:'ex_tortilla', name:{es:'Tortilla',en:'Tortilla'}, priceCents:70 }
    ];

    // ===== State & helpers =====
    const cart = new Map(); // id -> { id, name, priceCents, qty }
    const $ = s => document.querySelector(s);
    const t = v => typeof v === 'string' ? v : v[currentLang];
    const money = c => (c/100).toLocaleString(LOCALE[currentLang], { style:'currency', currency:'USD' });

    function add(item){
      const line = cart.get(item.id) || { ...item, qty:0 };
      line.qty++; cart.set(item.id, line);
      // visual feedback: in dark mode, turn the + Agregar button green for 2s
      const isDark = (document.documentElement.getAttribute('data-theme') || 'dark') === 'dark';
      if(isDark){
        const btn = document.querySelector(`button[data-act="add"][data-id="${item.id}"]`);
        if(btn){ btn.classList.add('btn-adding'); setTimeout(()=>btn.classList.remove('btn-adding'), 2000); }
      }
      render();
    }
    function rem(item){
      if(!cart.has(item.id)) return;
      const line = cart.get(item.id); line.qty--;
      if(line.qty<=0) cart.delete(item.id); else cart.set(item.id, line);
      render();
    }

    // ===== Build UI =====
    function buildOptions(){
      const host = $('#opts'); host.innerHTML='';
      OPTIONS.forEach((o,i)=>{
        const el = document.createElement('div');
        el.className='opt';
        el.innerHTML = `
          <div class="top">
            <button class="btn50 op${(i%4)+1}">${i+1}</button>
            <div>
              <div class="desc">${t(o.desc)} â€” <strong>${money(o.priceCents)}</strong></div>
              <div class="actions">
                <button class="btn" data-act="rem" data-id="${o.id}">âˆ’ Quitar</button>
                <button class="btn" data-act="add" data-id="${o.id}">+ Agregar</button>
              </div>
            </div>
          </div>`;
        host.appendChild(el);
      });
    }
    function buildExtras(){
      const host = $('#extras'); host.innerHTML='';
      EXTRAS.forEach(e=>{
        const row = document.createElement('div');
        row.className='ex-row';
        row.innerHTML = `
          <div class="ex-left">${t(e.name)} <span class="ex-price">${money(e.priceCents)}</span></div>
          <div class="actions">
            <button class="btn" data-act="rem" data-id="${e.id}">âˆ’</button>
            <button class="btn" data-act="add" data-id="${e.id}">+ Agregar</button>
          </div>`;
        host.appendChild(row);
      });
    }

    // ===== Render cart/totals =====
    function render(){
      const box = $('#cart'); box.innerHTML='';
      let subtotal = 0;
      cart.forEach(line=>{
        subtotal += line.priceCents * line.qty;
        const el = document.createElement('div');
        el.className='line';
        el.innerHTML = `
          <div>${line.name}</div>
          <div class="qtybox">
            <button class="btn" data-act="rem" data-id="${line.id}">âˆ’</button>
            <span>${line.qty}</span>
            <button class="btn" data-act="add" data-id="${line.id}">+</button>
          </div>
          <div><strong>${money(line.priceCents*line.qty)}</strong></div>`;
        box.appendChild(el);
      });
      const vat = Math.round(subtotal * IVA_RATE);
      const total = subtotal + vat;
      $('#subtotal').textContent = money(subtotal);
      $('#vat').textContent = money(vat);
      $('#total').textContent = money(total);
    }

    // ===== Lang + Theme =====
    $('#lang').addEventListener('click', ()=>{
      currentLang = currentLang==='es' ? 'en' : 'es';
      $('#lang').textContent = currentLang.toUpperCase();
      buildOptions(); buildExtras(); render();
    });
    $('#theme').addEventListener('click', ()=>{
      const root = document.documentElement;
      const cur = root.getAttribute('data-theme') || 'dark';
      const next = cur==='dark' ? 'light' : 'dark';
      root.setAttribute('data-theme', next);
      $('#theme').textContent = next==='light' ? 'ðŸŒž' : 'ðŸŒ™';
    });

    // ===== Events (add/remove via delegation) =====
    document.body.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-act]');
      if(!btn) return;
      const id = btn.getAttribute('data-id');
      const act = btn.getAttribute('data-act');
      const item = OPTIONS.find(x=>x.id===id) || EXTRAS.find(x=>x.id===id) || cart.get(id);
      if(!item) return;
      const payload = { id:item.id, name:(item.name?.[currentLang] ?? item.name), priceCents:item.priceCents };
      act==='add' ? add(payload) : rem(payload);
    });

    // ===== Submit to Google Sheets (loader + toast) =====
    const ENDPOINT = 'https://script.google.com/macros/s/AKfycbyQtQvKE_yp6bg9svD65cLeKmi4pTZCrJdMghdowRV93KKWbsTQ_fO6zg3B1gA9lO0/exec';
    const loader = $('#loader');
    const toast  = $('#toast');
    function showToast(msg, ms=1800){
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(()=>toast.classList.remove('show'), ms);
    }

    $('#accept').addEventListener('click', async ()=>{
      if(cart.size===0){ showToast('Carrito vacÃ­o'); return; }
      // build payload as array of rows (per item)
      const rows = [];
      cart.forEach(item=>{
        const rowSubtotal = item.qty * item.priceCents;
        const rowVAT = Math.round(rowSubtotal * IVA_RATE);
        const rowTotal = rowSubtotal + rowVAT;
        rows.push({
          timestamp: new Date().toISOString(),
          item: item.name,
          qty: item.qty,
          subtotal: (rowSubtotal/100).toFixed(2),
          vat: (rowVAT/100).toFixed(2),
          total: (rowTotal/100).toFixed(2)
        });
      });

      // show loader, send, then toast
      loader.style.display = 'flex';
      try{
        const res = await fetch(ENDPOINT, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(rows)
        });
        // hide loader -> show toast
        loader.style.display = 'none';
        if(res.ok){
          showToast('Â¡Pedido enviado con Ã©xito!');
          cart.clear(); render();
        }else{
          showToast('Error al enviar. Intenta de nuevo.');
        }
      }catch(err){
        loader.style.display = 'none';
        showToast('No se pudo conectar al servidor.');
      }
    });

    // ===== Init =====
    (function init(){
      document.documentElement.setAttribute('data-theme','dark');
      buildOptions(); buildExtras(); render();
    })();
  </script>
</body>
</html>
